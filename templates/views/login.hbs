<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>{{rpgname}}</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
    <h1>Logar</h1>
    <form id="loginForm">
        <p>
            <input type="text" placeholder="Login" id="username" name="username" required />
            <input type="password" placeholder="Senha" id="password" name="password" required />
        </p>
        <p><input type="submit" value="Entrar" /></p>
    </form>

    <p>NÃ£o possui cadastro? <a href="/register">Registrar-se</a></p>

    <script>
        const loginForm = $('#loginForm');

        function onLoginSuccess(data)
        {
            let id = data.playerID;
            console.log(id);
        }

        function onLoginFail(err)
        {
            const errorElement = document.createElement('p');
            const error = $(errorElement);

            error.css('color', 'red');
            error.css('font-size', 24);
            error.text(`Erro: ${err.responseText}`);

            $('body').append(errorElement);

            setTimeout(() =>
            {
                error.fadeOut(2000, () => error.remove());
            }, 500);

            console.error(`Server: ${err}`);

            loginForm.show();
        }

        loginForm.submit(ev =>
        {
            ev.preventDefault();

            loginForm.hide();

            const username = $('#username').val();
            const password = $('#password').val();

            $.ajax('/login',
            {
                method: 'POST',
                data: {username, password},
                success: onLoginSuccess,
                error: onLoginFail
            });
        });

    </script>
</body>

</html>